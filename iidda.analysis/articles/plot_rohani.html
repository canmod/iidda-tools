<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>plot_rohani • iidda.analysis</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="plot_rohani">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">iidda.analysis</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/flexi_filter.html">flexi_filter</a></li>
    <li><a class="dropdown-item" href="../articles/plot_rohani.html">plot_rohani</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>plot_rohani</h1>
            
      

      <div class="d-none name"><code>plot_rohani.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="plotting-infectious-disease-time-series">Plotting Infectious Disease Time-Series<a class="anchor" aria-label="anchor" href="#plotting-infectious-disease-time-series"></a>
</h2>
<p>(Disclaimer – I have not yet read very much about visualization of
specifically epidemiological data, so I am likely treating this topic
very naively. The point of this document is to start a discussion and
make a start on specifications for plotting functions in
<code>iidda.analysis</code>)</p>
<div class="section level3">
<h3 id="example-data">Example Data<a class="anchor" aria-label="anchor" href="#example-data"></a>
</h3>
<p>Throughout we will use communicable disease incidence data from
Canada in 1956.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://canmod.github.io/iidda-tools/iidda.api" class="external-link">iidda.api</a></span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: readr</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: httr</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: iidda</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: dplyr</span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Attaching package: 'dplyr'</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:stats':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     filter, lag</span></span></code></pre>
<pre><code><span><span class="co">## The following objects are masked from 'package:base':</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     intersect, setdiff, setequal, union</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: jsonlite</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: tibble</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: tidyr</span></span></code></pre>
<pre><code><span><span class="co">## Loading required package: rapiclient</span></span></code></pre>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw</span> <span class="op">=</span> <span class="fu">iidda.api</span><span class="fu">::</span><span class="va"><a href="https://canmod.github.io/iidda-tools/iidda.api/reference/ops.html" class="external-link">ops_staging</a></span><span class="op">$</span><span class="fu">raw_csv</span><span class="op">(</span>dataset_ids <span class="op">=</span> <span class="st">"cdi_ca_1956_wk_prov_dbs"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Now converting some fields from character to numeric or date. </span></span>
<span><span class="co">## You can turn this off with</span></span>
<span><span class="co">## options(iidda_api_all_char = TRUE). </span></span>
<span><span class="co">## Do not display any iidda.api messages with</span></span>
<span><span class="co">## options(iidda_api_msgs = FALSE).</span></span>
<span><span class="co">## Messages displayed at most once per R session.</span></span></code></pre>
<pre><code><span><span class="co">## Now sorting by date. </span></span>
<span><span class="co">## You can turn this off with</span></span>
<span><span class="co">## options(iidda_api_date_sort = FALSE). </span></span>
<span><span class="co">## Do not display any iidda.api messages with</span></span>
<span><span class="co">## options(iidda_api_msgs = FALSE).</span></span>
<span><span class="co">## Messages displayed at most once per R session.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: 947 parsing failures.</span></span>
<span><span class="co">## row col expected         actual</span></span>
<span><span class="co">##  27  -- a number Not reportable</span></span>
<span><span class="co">##  38  -- a number Not reportable</span></span>
<span><span class="co">##  39  -- a number Not reportable</span></span>
<span><span class="co">##  49  -- a number Not reportable</span></span>
<span><span class="co">##  50  -- a number Not reportable</span></span>
<span><span class="co">## ... ... ........ ..............</span></span>
<span><span class="co">## See problems(...) for more details.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: 1205 parsing failures.</span></span>
<span><span class="co">## row col expected         actual</span></span>
<span><span class="co">##  10  -- a number Not reportable</span></span>
<span><span class="co">##  27  -- a number Not reportable</span></span>
<span><span class="co">##  38  -- a number Not reportable</span></span>
<span><span class="co">##  39  -- a number Not reportable</span></span>
<span><span class="co">##  49  -- a number Not reportable</span></span>
<span><span class="co">## ... ... ........ ..............</span></span>
<span><span class="co">## See problems(...) for more details.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: 1208 parsing failures.</span></span>
<span><span class="co">## row col expected         actual</span></span>
<span><span class="co">##   9  -- a number Not reportable</span></span>
<span><span class="co">##  10  -- a number Not reportable</span></span>
<span><span class="co">##  27  -- a number Not reportable</span></span>
<span><span class="co">##  38  -- a number Not reportable</span></span>
<span><span class="co">##  39  -- a number Not reportable</span></span>
<span><span class="co">## ... ... ........ ..............</span></span>
<span><span class="co">## See problems(...) for more details.</span></span></code></pre>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">raw</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 16,016 × 15</span></span></span>
<span><span class="co">##    cases_cum_median_prev_5_years cases_cum_prev_year cases_cum_report_year</span></span>
<span><span class="co">##                            <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span>                          <span style="text-decoration: underline;">1</span>415                 921                   927</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span>                            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span>                            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span>                            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span>                            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span>                            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span>                            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span>                            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span>                            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span>                            <span style="color: #BB0000;">NA</span>                  <span style="color: #BB0000;">NA</span>                    <span style="color: #BB0000;">NA</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 16,006 more rows</span></span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 12 more variables: cases_median_prev_5_years &lt;dbl&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   cases_prev_period &lt;dbl&gt;, cases_this_period &lt;dbl&gt;, digitization_id &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   historical_disease &lt;chr&gt;, historical_disease_subclass &lt;chr&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   location &lt;chr&gt;, location_type &lt;chr&gt;, period_end_date &lt;date&gt;,</span></span></span>
<span><span class="co">## <span style="color: #949494;">#   period_start_date &lt;date&gt;, scan_id &lt;chr&gt;, time_scale &lt;chr&gt;</span></span></span></code></pre>
<p>Our focal example within these data are for weekly measles counts
broken down by province.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="va">measles</span> <span class="op">=</span> <span class="op">(</span><span class="va">raw</span></span>
<span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">historical_disease</span><span class="op">)</span> <span class="op">==</span> <span class="st">"measles"</span><span class="op">)</span></span>
<span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time_scale</span> <span class="op">==</span> <span class="st">"wk"</span>, <span class="va">location_type</span> <span class="op">==</span> <span class="st">"province"</span><span class="op">)</span></span>
<span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">location</span>, <span class="va">period_start_date</span>, <span class="va">cases_this_period</span><span class="op">)</span></span>
<span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>period_start_date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">period_start_date</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>cases_this_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">cases_this_period</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">measles</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 520 × 3</span></span></span>
<span><span class="co">##    location period_start_date cases_this_period</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 1</span> NFLD.    1956-01-01                       55</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 2</span> P.E.I.   1956-01-01                       69</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 3</span> N.S      1956-01-01                       86</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 4</span> N.B.     1956-01-01                        0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 5</span> QUE.     1956-01-01                       95</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 6</span> ONT.     1956-01-01                     <span style="text-decoration: underline;">1</span>188</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 7</span> MAN.     1956-01-01                       11</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 8</span> SASK.    1956-01-01                        1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;"> 9</span> ALTA.    1956-01-01                       47</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">10</span> B.C.     1956-01-01                       22</span></span>
<span><span class="co">## <span style="color: #949494;"># ℹ 510 more rows</span></span></span></code></pre>
<p>To get a sense of these data, here is the plot for the province of
Ontario.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">measles</span>, <span class="va">location</span> <span class="op">==</span> <span class="st">"ONT."</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">period_start_date</span>, <span class="va">cases_this_period</span>, type <span class="op">=</span> <span class="st">"l"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="plot_rohani_files/figure-html/ontario_measles_plot-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="generalizing-rohani-earn-and-grenfell">Generalizing Rohani, Earn, and Grenfell<a class="anchor" aria-label="anchor" href="#generalizing-rohani-earn-and-grenfell"></a>
</h3>
<p><a href="https://ms.mcmaster.ca/earn.old/pdfs/Roha+1999_Science_OppositePatterns.pdf" class="external-link">Rohani,
Earn, and Grenfell (1999)</a> developed a method for plotting time
series of cases of a disease, broken down by geographic location. The
geographic locations are ordered along one of the y-axes of the plot by
population size. We generalize this plot by allowing geographic location
to be any ordinal grouping variable. We additionally generalize by
allowing cases to be any positive variable that can be meaningfully
summed over the observed times within the levels of the grouping
variable.</p>
<p>A data structure that would contain all of the information required
to make such a plot consists of two tables; one for the generalized
cases variable (call it the series data) and one for the generalized
geographical location variable (call it the grouping table). For our
measles data we can get the series</p>
<p>With this generalization one could construct a function to produce
these plots.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a><span class="do">##' Plot Rohani Diagram</span></span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="do">##'</span></span>
<span id="cb24-3"><a href="#cb24-3" tabindex="-1"></a><span class="do">##' @param series_col Name of column in \code{data_series} giving the numerical </span></span>
<span id="cb24-4"><a href="#cb24-4" tabindex="-1"></a><span class="do">##' variable of interest (e.g. numbers of cases).</span></span>
<span id="cb24-5"><a href="#cb24-5" tabindex="-1"></a><span class="do">##' @param time_col Name of column in \code{data_series} giving a date-time </span></span>
<span id="cb24-6"><a href="#cb24-6" tabindex="-1"></a><span class="do">##' variable to plot on the x-axis.</span></span>
<span id="cb24-7"><a href="#cb24-7" tabindex="-1"></a><span class="do">##' @param grouping_col Name of column in both \code{data_series} and </span></span>
<span id="cb24-8"><a href="#cb24-8" tabindex="-1"></a><span class="do">##' \code{data_groups} giving the labels of the grouping variable. This </span></span>
<span id="cb24-9"><a href="#cb24-9" tabindex="-1"></a><span class="do">##' variable will be unique in \code{data_groups}, but will be repeated in</span></span>
<span id="cb24-10"><a href="#cb24-10" tabindex="-1"></a><span class="do">##' \code{data_series} over the different time periods.</span></span>
<span id="cb24-11"><a href="#cb24-11" tabindex="-1"></a>plot_rohani <span class="ot">=</span> <span class="cf">function</span>(</span>
<span id="cb24-12"><a href="#cb24-12" tabindex="-1"></a>  series_col, </span>
<span id="cb24-13"><a href="#cb24-13" tabindex="-1"></a>  time_col, </span>
<span id="cb24-14"><a href="#cb24-14" tabindex="-1"></a>  grouping_col, </span>
<span id="cb24-15"><a href="#cb24-15" tabindex="-1"></a>  ranking_col, </span>
<span id="cb24-16"><a href="#cb24-16" tabindex="-1"></a>  data_series, </span>
<span id="cb24-17"><a href="#cb24-17" tabindex="-1"></a>  data_groups</span>
<span id="cb24-18"><a href="#cb24-18" tabindex="-1"></a>)</span></code></pre></div>
<p>Note that we are assuming that the</p>
<p>TODO: these graphs: <a href="https://ms.mcmaster.ca/earn.old/pdfs/KrylEarn2020_PLoSBiology_SmallpoxLondon.pdf" class="external-link uri">https://ms.mcmaster.ca/earn.old/pdfs/KrylEarn2020_PLoSBiology_SmallpoxLondon.pdf</a>
and these <a href="https://ms.mcmaster.ca/earn.old/pdfs/Tien+2011_JRSI_CholeraHeraldWaves.pdf" class="external-link uri">https://ms.mcmaster.ca/earn.old/pdfs/Tien+2011_JRSI_CholeraHeraldWaves.pdf</a></p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steven Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
