<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Dataset Provenance â€¢ iidda.api</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Dataset Provenance">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">iidda.api</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.4.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Quickstart.html">Quick Start</a></li>
    <li><a class="dropdown-item" href="../articles/Provenance.html">Dataset Provenance</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/canmod/iidda-tools/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Dataset Provenance</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/canmod/iidda-tools/blob/main/vignettes/Provenance.Rmd" class="external-link"><code>vignettes/Provenance.Rmd</code></a></small>
      <div class="d-none name"><code>Provenance.Rmd</code></div>
    </div>

    
    
<p>In this vignette we illustrate how to investigate the provenance of a
particular record in the a dataset obtained from the API. We use an
example of a surprisingly late smallpox record in the CANDID data.</p>
<p><img src="images/Smallpox_virus_virions_TEM_PHIL_1849.JPG" style="width:60.0%"></p>
<p>(Image From: <a href="https://phil.cdc.gov/details.aspx?pid=1849" class="external-link uri">https://phil.cdc.gov/details.aspx?pid=1849</a>)</p>
<div class="section level2">
<h2 id="preliminaries">Preliminaries<a class="anchor" aria-label="anchor" href="#preliminaries"></a>
</h2>
<p>We use the following packages for this illustration.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://canmod.github.io/iidda-tools/iidda.api">iidda.api</a></span><span class="op">)</span></span></code></pre></div>
<p>We require a hook for the API, which in this case is
<code><a href="../reference/ops.html">iidda.api::ops_staging</a></code>. This hook will eventually be
changed to <code><a href="../reference/ops.html">iidda.api::ops</a></code> once we stabilize. In fact if you
do not have access to the <a href="https://github.com/canmod/iidda-staging" class="external-link">iidda-staging</a>
repository you will need to wait until we stabilize.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">api_hook</span> <span class="op">=</span> <span class="fu">iidda.api</span><span class="fu">::</span><span class="va"><a href="../reference/ops.html">ops_staging</a></span></span></code></pre></div>
<p>For convenience we define a custom <code>print</code> function and
turn off messages from the API that are not helpful when presenting the
material.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">print_single_row</span> <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="op">(</span><span class="va">data</span></span>
<span>    <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>    <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> </span>
<span>    <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/stats/setNames.html" class="external-link">setNames</a></span><span class="op">(</span><span class="st">"Value"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>iidda_api_msgs <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-the-last-case-of-smallpox">Example: The Last Case of Smallpox<a class="anchor" aria-label="anchor" href="#example-the-last-case-of-smallpox"></a>
</h2>
<p>Smallpox has been eliminated from Canada in 1946 <a href="https://www.cmaj.ca/content/161/12/1543" class="external-link">https://www.cmaj.ca/content/161/12/1543</a>.
Then why does IIDDA have a case in Alberta in 1980?</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">smallpox</span> <span class="op">=</span> <span class="va">api_hook</span><span class="op">$</span><span class="fu">filter</span><span class="op">(</span>resource_type <span class="op">=</span> <span class="st">"Compilation"</span></span>
<span>  , dataset_ids <span class="op">=</span> <span class="st">"canmod-cdi-normalized"</span></span>
<span>  , basal_disease <span class="op">=</span> <span class="st">"smallpox"</span></span>
<span><span class="op">)</span></span>
<span><span class="va">latest_smallpox</span> <span class="op">=</span> <span class="op">(</span><span class="va">smallpox</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">cases_this_period</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">)</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">period_start_date</span><span class="op">)</span> <span class="op">==</span> <span class="va">period_start_date</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="op">(</span><span class="va">latest_smallpox</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span></span>
<span>    , <span class="va">iso_3166_2</span></span>
<span>    , <span class="va">period_start_date</span></span>
<span>    , <span class="va">period_end_date</span></span>
<span>    , <span class="va">cases_this_period</span></span>
<span>  <span class="op">)</span> </span>
<span>  <span class="op">|&gt;</span> <span class="fu">print_single_row</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt;                        Value</span></span>
<span><span class="co">#&gt; iso_3166_2             CA-AB</span></span>
<span><span class="co">#&gt; period_start_date 1979-12-30</span></span>
<span><span class="co">#&gt; period_end_date   1980-01-26</span></span>
<span><span class="co">#&gt; cases_this_period          1</span></span></code></pre></div>
<p>Thatâ€™s got to be wrong, right?</p>
<p>This is one of the many instances where one will want to go back to
the source documents to check whether surprising data represent errors
in the data curation process.</p>
<p>The CANMOD data have columns containing provenance information. These
columns give identifiers for resources used to produce each record. For
our smallpox case we have the following provenance.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">provenance</span> <span class="op">=</span> <span class="op">(</span><span class="va">latest_smallpox</span></span>
<span>  <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span><span class="op">(</span></span>
<span>      <span class="va">original_dataset_id</span></span>
<span>    , <span class="va">digitization_id</span></span>
<span>    , <span class="va">scan_id</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">print_single_row</span><span class="op">(</span><span class="va">provenance</span><span class="op">)</span></span>
<span><span class="co">#&gt;                                               Value</span></span>
<span><span class="co">#&gt; original_dataset_id cdi_ca_1979-83_4wk_prov_statcan</span></span>
<span><span class="co">#&gt; digitization_id     cdi_ca_1979-83_4wk_prov_statcan</span></span>
<span><span class="co">#&gt; scan_id             cdi_ca_1979-83_4wk_prov_statcan</span></span></code></pre></div>
<p>Here we see identifiers for the original dataset that was included in
the compiled dataset, for the digitization (which is an Excel file
containing manually entered data), and for the PDF scan of the original
source document. These identifiers are of no use unless we can use them
to find these resources. Here we show how.</p>
<p>Letâ€™s start with the scan to see if the original source actually
published this very late smallpox case. We use the
<code><a href="../reference/urls.html">?url_scans</a></code> function to convert this identifier into an URL
at which we can find the document.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/urls.html">url_scans</a></span><span class="op">(</span><span class="va">provenance</span><span class="op">$</span><span class="va">scan_id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "https://github.com/davidearn/iidda/blob/main/pipelines/cdi_ca_1979-89_4wk_prov/scans/cdi_ca_1979-83_4wk_prov_statcan.pdf"</span></span></code></pre></div>
<p>It takes some time to find the specific part of this document that
contains our datum. It is actually a little more difficult than usual in
this case, because the document has spread the columns of a single table
across two pages. We simplify here by cutting and pasting the relevant
parts of the table together, and indeed we do find a single case of
smallpox in Albert in January of 1980.</p>
<p><img src="Provenance_files/figure-html/images-1.png" width="576"></p>
<p>So in this case it looks like an error that was made before this
source document was published, but in some cases we need to look further
to see if we introduced the error in our curation process. The next
place to look would usually be the digitized Excel file, which we can
get using the <code><a href="../reference/urls.html">?url_digitizations</a></code> function.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/urls.html">url_digitizations</a></span><span class="op">(</span><span class="va">provenance</span><span class="op">$</span><span class="va">digitization_id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "https://github.com/davidearn/iidda/blob/main/pipelines/cdi_ca_1979-89_4wk_prov/digitizations/cdi_ca_1979-83_4wk_prov_statcan.xlsx"</span></span></code></pre></div>
<p>We can also find all of the prep-scripts that would potentially have
their output modified if we updated this digitization using the
<code><a href="../reference/urls.html">?url_affected_scripts</a></code> function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/urls.html">url_affected_scripts</a></span><span class="op">(</span><span class="va">provenance</span><span class="op">$</span><span class="va">digitization_id</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "https://github.com/davidearn/iidda/blob/main/pipelines/cdi_ca_1979-89_4wk_prov_harmonized/prep-scripts/cdi_ca_1979-89_4wk_prov_harmonized.R"</span></span>
<span><span class="co">#&gt; [2] "https://github.com/davidearn/iidda/blob/main/pipelines/canmod-compilations/prep-scripts/canmod-cdi-normalized.R"                            </span></span>
<span><span class="co">#&gt; [3] "https://github.com/davidearn/iidda/blob/main/pipelines/cdi_ca_1979-89_4wk_prov/prep-scripts/cdi_ca_1979-83_4wk_province_statisticscanada.R" </span></span>
<span><span class="co">#&gt; [4] "https://github.com/davidearn/iidda/blob/main/pipelines/canmod-cross-checks/prep-scripts/canmod-time-scale-cross-check.R"                    </span></span>
<span><span class="co">#&gt; [5] "https://github.com/davidearn/iidda/blob/main/pipelines/canmod-compilations/prep-scripts/canmod-cdi-unharmonized.R"                          </span></span>
<span><span class="co">#&gt; [6] "https://github.com/davidearn/iidda/blob/main/pipelines/canmod-cross-checks/prep-scripts/canmod-location-cross-check.R"                      </span></span>
<span><span class="co">#&gt; [7] "https://github.com/davidearn/iidda/blob/main/pipelines/canmod-cross-checks/prep-scripts/canmod-disease-cross-check.R"                       </span></span>
<span><span class="co">#&gt; [8] "https://github.com/davidearn/iidda/blob/main/pipelines/canmod-compilations/prep-scripts/canmod-cdi-harmonized.R"</span></span></code></pre></div>
<p>Finally, note that these <code>url_*</code> functions are nicely
paired with the base R <code><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">?browseURL</a></code> function.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Steve Walker.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
